![Automating Threat Detection](https://raw.githubusercontent.com/cloudbrdesign/Automating-Threat-Detection-with-GuardDuty-and-Bedrock/main/Assets/Automating_Threat_Detection.001.png)

# Conceptual Information
### **1\. GuardDuty — Threat Detection**

*   **GuardDuty** is AWS’ managed threat-detection service.
    
*   Continuously monitors your AWS accounts, workloads, and logs for suspicious or malicious activity.
    
*   _“Hey, this looks bad.”_
    

### **2\. EventBridge — Event Routing**

*   GuardDuty automatically sends its findings to **Amazon EventBridge**.
    
*   EventBridge acts as an **event router**, matching incoming findings to rules you define.
    
*   A rule forwards each finding to a **Lambda function** for further processing.
    

### **3\. Lambda — Trigger the Workflow**

*   A small **Lambda function** receives the finding from EventBridge.
    
*   Its job is to **start a Step Functions workflow**, passing the GuardDuty data along.
    

### **4\. Step Functions — Orchestration Layer**

*   **AWS Step Functions** coordinates the multi-step process.
    
*   Inside the workflow, another Lambda function is invoked to handle the AI summarisation workflow.
    

### **5\. Lambda → Amazon Bedrock — AI Summarisation**

*   The second **Lambda function** calls **Amazon Bedrock**.
*   A large language model processes the GuardDuty finding and generates a plain-English summary, describing:
    
*   *   What the threat is
        
    *   Why it matters
        
    *   Potential impact
        
    *   (Optional) Suggested remediation steps
        

### **6\. Amazon SNS — Notification Delivery**

*   The AI-generated summary is then published to **Amazon SNS**.
    
*   SNS sends an **email notification** containing the **AI-written threat summary**.
    

**Final Outcome**
-----------------

You receive an automated **email with a clear, human-readable explanation** of a GuardDuty finding — fully generated by AI, triggered by real-time threat detection.

# Hands-on Lab

**Section 2 – Check Your Toolkit**
----------------------------------

Open your terminal.

Let’s make sure the AWS CLI is installed and available. Type — or paste if you prefer — this command:

`aws --version`

You should see something like _aws-cli 2.x.x_.

If you don’t, pause here and install AWS CLI v2 before moving on.

Next, let’s confirm who we’re authenticated as.

`aws sts get-caller-identity`

You’ll get a JSON response showing your _User ID_, _Account ID_, and _ARN_.

Those numbers tell us which account our resources will live in.

Keep that Account ID nearby — you’ll recognize it later inside every ARN we create.”

**Section 3 – Lock Your Region**
--------------------------------

Because GuardDuty, Bedrock, and Step Functions are regional services, we need to choose one AWS region and stick with it.

I’ll be using **eu-west-1 — Ireland**, but feel free to pick another Bedrock-supported region if it’s closer to you.

Just remember: once you choose, don’t switch halfway through the course.”

`REGION=eu-west-1`

`export AWS_REGION=$REGION`

`export AWS_DEFAULT_REGION=$REGION`

`aws configure get region`

When that last command prints _eu-west-1_, we’re officially anchored.

**Section 4 – Save Account & Region Variables**
-----------------------------------------------

`ACCOUNT_ID=$(aws sts get-caller-identity --query 'Account' --output text)`

`echo "Account: $ACCOUNT_ID, Region: $REGION"`

Perfect — this variable will be used in almost every command that follows.

**Section 5 – Verify Access to Services**
-----------------------------------------------
Before we begin creating resources, let's confirm we actually have permission to access the key services we will use.

`aws guardduty list-detectors --region $REGION`

If you see a **detector ID** or even an empty list, you are good - it means the service is reachable.

`aws bedrock list-foundation-models --region $REGION`

If this runs without an **AccessDenied** error, you have **Bedrock** access. 

`aws sns list-topics --region $REGION --max-items 1` ,
`aws stepfunctions list-state-machines --region $REGION --max-items 1`

Both of these commands should succeed silently. Any permission error means your IAM user or role needs broader access to SNS or Step Functions.

